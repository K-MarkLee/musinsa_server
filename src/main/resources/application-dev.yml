spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      # Dev default: tuned for laptop load-test without overloading local DB.
      # Override per-machine via env vars if needed.
      maximum-pool-size: 30
      minimum-idle: 10
      idle-timeout: 300000
      max-lifetime: 1700000
      connection-timeout: 30000
      validation-timeout: 5000
      leak-detection-threshold: ${DB_POOL_LEAK_DETECT_MS:0}

  kafka:
    bootstrap-servers: localhost:9092
  # rabbitmq:
  #   host: ${RABBIT_HOST}
  #   port: 61613
  #   username: guest
  #   password: guest
  #   listener:
  #     simple:
  #       concurrency: 4     # 기본 1
  #       max-concurrency: 16
  #       prefetch: 20


  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: false

  elasticsearch:
    uris: http://localhost:9200
#    uris: ${OPENSEARCH_SCHEME:http}://${OPENSEARCH_HOST:localhost}:${OPENSEARCH_PORT:9200}
    connection-timeout: 5s
    socket-timeout: 30s
    # username: ${OPENSEARCH_USERNAME}
    # password: ${OPENSEARCH_PASSWORD}

tosspayments:
  secret-key: test_gsk_docs_OaPz8L5KdmQXkzRz3y47BMw6
  client-key: test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm
  confirm_url: ${TOSS_CONFIRM_URL}
  base_cancel_url: ${TOSS_CANCEL_URL}

fcm:
  service-account-file: key/fdbdproject.json
  topic-name: fdbdMessage
  project-id: fdbdproject

aws:
  s3:
    bucket: ${S3_BUCKET}
    accessKey: ${S3_ACCESS_KEY}
    secretKey: ${S3_SECRET_KEY}

server:
  port: ${SERVER_PORT:8080}
  address: 0.0.0.0
  tomcat:
    threads:
      max: ${TOMCAT_THREADS_MAX:200} # Tuned for M3 Max Concurrency
      min-spare: ${TOMCAT_THREADS_MIN_SPARE:25}
    accept-count: 2048
    max-connections: ${TOMCAT_MAX_CONNECTIONS:8192}
    connection-timeout: ${TOMCAT_CONNECTION_TIMEOUT_MS:20000}
    keep-alive-timeout: ${TOMCAT_KEEP_ALIVE_TIMEOUT_MS:60000}
    max-keep-alive-requests: ${TOMCAT_MAX_KEEP_ALIVE_REQUESTS:100}

management:
  endpoints:
    web:
      exposure:
        include: prometheus, health, info

  tracing:
    enabled: false
    sampling:
      probability: ${TRACING_SAMPLING_PROBABILITY:0.1}
    propagation:
      propagate: tracecontext,baggage

  otlp:
    tracing:
      endpoint: ${OTLP_TRACES_ENDPOINT:http://localhost:4318/v1/traces}

logging:
  level:
    org:
      elasticsearch.client: ERROR
      hibernate:
        sql: ERROR
        type.descriptor.sql.BasicBinder: TRACE
        orm.jdbc.internal.LogicalConnectionImpl: ERROR
      springframework.orm.jpa: ERROR
      springframework.transaction: ERROR
      springframework.web.client.RestTemplate: ERROR
      com.mudosa.musinsa.common.client: ERROR
